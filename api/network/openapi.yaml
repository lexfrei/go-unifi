openapi: 3.0.3
info:
  title: UniFi Network API
  version: 1.0.0
  description: |
    UniFi Network API provides programmatic access to UniFi network devices, clients, DNS, and configurations
    running on local UniFi controllers.

    This is the Local Application API, accessed through the UniFi controller at `/proxy/network/`.

    ## Authentication
    All requests require an API key passed via the X-API-KEY header.

    ## API Versions
    - **Integration API (v1)**: `/proxy/network/integration/v1` - Sites, Devices, Clients
    - **DNS API (v2)**: `/proxy/network/v2/api/site/{site}/static-dns` - Static DNS records

    ## Features
    - Site management and listing
    - Device inventory and monitoring
    - Client tracking and access control
    - Static DNS record management
    - Real-time status information

  contact:
    name: Aleksei Sviridkin
    email: f@lex.la
  license:
    name: BSD-3-Clause
    url: https://opensource.org/licenses/BSD-3-Clause

servers:
  - url: https://{controller}/proxy/network
    description: Local UniFi controller
    variables:
      controller:
        default: unifi.local
        description: Hostname or IP address of your UniFi controller (e.g., unifi.local, 192.168.1.1)

security:
  - ApiKeyAuth: []

tags:
  - name: Sites
    description: Site management and listing operations
  - name: Devices
    description: Network device management and monitoring
  - name: Clients
    description: Client device tracking and access control
  - name: DNS
    description: Static DNS record management

paths:
  /integration/v1/sites:
    get:
      summary: List all sites
      description: |
        Retrieves a paginated list of all UniFi sites configured on the controller.

        Each site represents a logical grouping of network devices and clients.
      operationId: listSites
      tags:
        - Sites
      parameters:
        - $ref: '#/components/parameters/Offset'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: Successful response with list of sites
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SitesResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /integration/v1/sites/{siteId}/devices:
    get:
      summary: List devices for a site
      description: |
        Retrieves a paginated list of all network devices (routers, switches, access points)
        associated with the specified site.
      operationId: listSiteDevices
      tags:
        - Devices
      parameters:
        - $ref: '#/components/parameters/SiteId'
        - $ref: '#/components/parameters/Offset'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: Successful response with list of devices
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DevicesResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /integration/v1/sites/{siteId}/devices/{deviceId}:
    get:
      summary: Get device details
      description: |
        Retrieves detailed information about a specific network device, including:
        - Hardware specifications and model
        - Firmware version and update status
        - Network interfaces (ports, radios)
        - Operational state and statistics
        - Configuration details
      operationId: getDeviceById
      tags:
        - Devices
      parameters:
        - $ref: '#/components/parameters/SiteId'
        - $ref: '#/components/parameters/DeviceId'
      responses:
        '200':
          description: Successful response with device details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Device'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /integration/v1/sites/{siteId}/clients:
    get:
      summary: List clients for a site
      description: |
        Retrieves a paginated list of all client devices (computers, phones, IoT devices)
        currently or recently connected to the specified site.
      operationId: listSiteClients
      tags:
        - Clients
      parameters:
        - $ref: '#/components/parameters/SiteId'
        - $ref: '#/components/parameters/Offset'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: Successful response with list of clients
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /integration/v1/sites/{siteId}/clients/{clientId}:
    get:
      summary: Get client details
      description: |
        Retrieves detailed information about a specific client device, including:
        - Connection type (wired/wireless)
        - Network addresses (IP, MAC)
        - Uplink device information
        - Access control settings
        - Connection timestamps
      operationId: getClientById
      tags:
        - Clients
      parameters:
        - $ref: '#/components/parameters/SiteId'
        - $ref: '#/components/parameters/ClientId'
      responses:
        '200':
          description: Successful response with client details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NetworkClient'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # DNS API (v2)
  /v2/api/site/{site}/static-dns:
    get:
      summary: List DNS records
      description: |
        Retrieves all static DNS records configured for the specified site.

        Supports all standard DNS record types: A, AAAA, CNAME, MX, NS, SRV, TXT.
      operationId: listDNSRecords
      tags:
        - DNS
      parameters:
        - $ref: '#/components/parameters/Site'
      responses:
        '200':
          description: Successful response with list of DNS records
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DNSRecord'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      summary: Create DNS record
      description: |
        Creates a new static DNS record for the specified site.

        For SRV records, provide priority, weight, and port fields.
      operationId: createDNSRecord
      tags:
        - DNS
      parameters:
        - $ref: '#/components/parameters/Site'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DNSRecordInput'
      responses:
        '200':
          description: Successfully created DNS record
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DNSRecord'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /v2/api/site/{site}/static-dns/{recordId}:
    get:
      summary: Get DNS record by ID
      description: Retrieves details of a specific DNS record
      operationId: getDNSRecordById
      tags:
        - DNS
      parameters:
        - $ref: '#/components/parameters/Site'
        - $ref: '#/components/parameters/RecordId'
      responses:
        '200':
          description: Successful response with DNS record details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DNSRecord'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      summary: Update DNS record
      description: Updates an existing DNS record
      operationId: updateDNSRecord
      tags:
        - DNS
      parameters:
        - $ref: '#/components/parameters/Site'
        - $ref: '#/components/parameters/RecordId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DNSRecordInput'
      responses:
        '200':
          description: Successfully updated DNS record
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DNSRecord'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      summary: Delete DNS record
      description: Deletes a DNS record from the site
      operationId: deleteDNSRecord
      tags:
        - DNS
      parameters:
        - $ref: '#/components/parameters/Site'
        - $ref: '#/components/parameters/RecordId'
      responses:
        '204':
          description: Successfully deleted DNS record
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-KEY
      description: API key generated from UniFi controller (Settings > Control Plane > Integrations)

  parameters:
    SiteId:
      name: siteId
      in: path
      required: true
      description: The unique identifier of the site (UUID format)
      schema:
        type: string
        format: uuid
      example: 88f7af54-98f8-306a-a1c7-c9349722b1f6

    DeviceId:
      name: deviceId
      in: path
      required: true
      description: The unique identifier of the device (UUID format)
      schema:
        type: string
        format: uuid
      example: 71cb254a-b068-39f9-9138-0fbf8fe11cac

    ClientId:
      name: clientId
      in: path
      required: true
      description: The unique identifier of the client (UUID format)
      schema:
        type: string
        format: uuid
      example: f95a0eb4-ddf9-3f41-942c-1793ac30d4c9

    Offset:
      name: offset
      in: query
      description: Number of items to skip before starting to return results (for pagination)
      required: false
      schema:
        type: integer
        minimum: 0
        default: 0
      example: 0

    Limit:
      name: limit
      in: query
      description: Maximum number of items to return per page
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 25
      example: 25

    Site:
      name: site
      in: path
      required: true
      description: The site name (internal reference)
      schema:
        type: string
      example: default

    RecordId:
      name: recordId
      in: path
      required: true
      description: The unique identifier of the DNS record
      schema:
        type: string
      example: 68e04e991056cd46ea9edcd4

  responses:
    Unauthorized:
      description: Unauthorized - Invalid or missing API key
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            statusCode: 401
            statusName: UNAUTHORIZED
            message: Invalid API key
            timestamp: "2025-11-11T16:00:00Z"
            requestPath: /integration/v1/sites

    NotFound:
      description: Not Found - Resource or endpoint does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            statusCode: 404
            statusName: NOT_FOUND
            message: "No endpoint GET /integration/v1/sites/invalid-id"
            timestamp: "2025-11-11T16:00:00Z"
            requestPath: /integration/v1/sites/invalid-id

  schemas:
    # Base response types
    PaginatedResponse:
      type: object
      required:
        - offset
        - limit
        - count
        - totalCount
        - data
      properties:
        offset:
          type: integer
          description: Number of items skipped
          example: 0
        limit:
          type: integer
          description: Maximum number of items per page
          example: 25
        count:
          type: integer
          description: Number of items in current response
          example: 1
        totalCount:
          type: integer
          description: Total number of items available
          example: 1

    ErrorResponse:
      type: object
      required:
        - statusCode
        - statusName
        - message
        - timestamp
        - requestPath
      properties:
        statusCode:
          type: integer
          description: HTTP status code
          example: 404
        statusName:
          type: string
          description: HTTP status name
          example: NOT_FOUND
        message:
          type: string
          description: Human-readable error message
          example: "No endpoint GET /integration/v1/sites/invalid-id"
        timestamp:
          type: string
          format: date-time
          description: Timestamp when the error occurred (RFC3339 format)
          example: "2025-11-11T16:00:00Z"
        requestPath:
          type: string
          description: The request path that caused the error
          example: /integration/v1/sites/invalid-id

    # Sites
    SitesResponse:
      allOf:
        - $ref: '#/components/schemas/PaginatedResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/SiteListItem'

    SiteListItem:
      type: object
      required:
        - id
        - internalReference
        - name
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the site
          example: 88f7af54-98f8-306a-a1c7-c9349722b1f6
        internalReference:
          type: string
          description: Internal reference name used in UniFi controller URLs
          example: default
        name:
          type: string
          description: Display name of the site
          example: Default

    # Devices
    DevicesResponse:
      allOf:
        - $ref: '#/components/schemas/PaginatedResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/DeviceListItem'

    DeviceListItem:
      type: object
      required:
        - id
        - name
        - model
        - macAddress
        - ipAddress
        - state
        - features
        - interfaces
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the device
          example: 71cb254a-b068-39f9-9138-0fbf8fe11cac
        name:
          type: string
          description: Display name of the device
          example: LexFrei's home
        model:
          type: string
          description: Device model identifier
          example: UDR7
        macAddress:
          type: string
          description: MAC address of the device
          example: "94:2a:6f:ce:26:52"
        ipAddress:
          type: string
          description: IP address of the device
          example: 217.78.182.161
        state:
          type: string
          description: Current operational state
          enum:
            - ONLINE
            - OFFLINE
            - UPGRADING
            - PROVISIONING
          example: ONLINE
        features:
          type: array
          description: List of features supported by this device
          items:
            type: string
            enum:
              - switching
              - accessPoint
              - routing
              - gateway
          example:
            - switching
            - accessPoint
        interfaces:
          type: array
          description: Types of network interfaces available
          items:
            type: string
            enum:
              - ports
              - radios
              - wan
          example:
            - ports
            - radios

    Device:
      type: object
      required:
        - id
        - name
        - model
        - supported
        - macAddress
        - ipAddress
        - state
        - firmwareVersion
        - firmwareUpdatable
        - provisionedAt
        - configurationId
        - features
        - interfaces
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the device
          example: 71cb254a-b068-39f9-9138-0fbf8fe11cac
        name:
          type: string
          description: Display name of the device
          example: LexFrei's home
        model:
          type: string
          description: Device model identifier
          example: UDR7
        supported:
          type: boolean
          description: Whether this device is officially supported
          example: true
        macAddress:
          type: string
          description: MAC address of the device
          example: "94:2a:6f:ce:26:52"
        ipAddress:
          type: string
          description: IP address of the device
          example: 217.78.182.161
        state:
          type: string
          description: Current operational state
          enum:
            - ONLINE
            - OFFLINE
            - UPGRADING
            - PROVISIONING
          example: ONLINE
        firmwareVersion:
          type: string
          description: Current firmware version
          example: 4.3.9
        firmwareUpdatable:
          type: boolean
          description: Whether firmware update is available
          example: false
        provisionedAt:
          type: string
          format: date-time
          description: Timestamp when device was provisioned (RFC3339 format)
          example: "2025-11-03T21:41:04Z"
        configurationId:
          type: string
          description: Current configuration identifier
          example: c212be130585ee93
        features:
          type: object
          description: Feature-specific configuration and capabilities
          additionalProperties:
            type: object
          example:
            switching: {}
            accessPoint: {}
        interfaces:
          $ref: '#/components/schemas/DeviceInterfaces'

    DeviceInterfaces:
      type: object
      description: Network interfaces available on the device
      properties:
        ports:
          type: array
          description: Physical ethernet ports
          items:
            $ref: '#/components/schemas/Port'
        radios:
          type: array
          description: Wireless radio interfaces
          items:
            $ref: '#/components/schemas/Radio'

    Port:
      type: object
      required:
        - idx
        - state
        - connector
        - maxSpeedMbps
        - speedMbps
      properties:
        idx:
          type: integer
          description: Port index number (1-based)
          example: 1
        state:
          type: string
          description: Current port state
          enum:
            - UP
            - DOWN
          example: UP
        connector:
          type: string
          description: Physical connector type
          enum:
            - RJ45
            - SFPPLUS
            - SFP
          example: RJ45
        maxSpeedMbps:
          type: integer
          description: Maximum supported speed in Mbps
          example: 2500
        speedMbps:
          type: integer
          description: Current negotiated speed in Mbps
          example: 1000
        poe:
          $ref: '#/components/schemas/PoE'

    PoE:
      type: object
      description: Power over Ethernet configuration and status
      required:
        - standard
        - type
        - enabled
        - state
      properties:
        standard:
          type: string
          description: PoE standard supported
          enum:
            - 802.3af
            - 802.3at
            - 802.3bt
          example: 802.3af
        type:
          type: integer
          description: PoE type number
          example: 1
        enabled:
          type: boolean
          description: Whether PoE is enabled on this port
          example: true
        state:
          type: string
          description: Current PoE state
          enum:
            - UP
            - DOWN
            - DISABLED
          example: UP

    Radio:
      type: object
      required:
        - wlanStandard
        - frequencyGHz
        - channelWidthMHz
        - channel
      properties:
        wlanStandard:
          type: string
          description: WiFi standard supported
          enum:
            - 802.11a
            - 802.11b
            - 802.11g
            - 802.11n
            - 802.11ac
            - 802.11ax
            - 802.11be
          example: 802.11be
        frequencyGHz:
          type: number
          format: float
          description: Operating frequency in GHz
          enum:
            - 2.4
            - 5
            - 6
          example: 2.4
        channelWidthMHz:
          type: integer
          description: Channel width in MHz
          enum:
            - 20
            - 40
            - 80
            - 160
          example: 20
        channel:
          type: integer
          description: WiFi channel number
          example: 6

    # Clients
    ClientsResponse:
      allOf:
        - $ref: '#/components/schemas/PaginatedResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/ClientListItem'

    ClientListItem:
      type: object
      required:
        - type
        - id
        - name
        - connectedAt
        - ipAddress
        - macAddress
        - uplinkDeviceId
        - access
      properties:
        type:
          type: string
          description: Connection type
          enum:
            - WIRED
            - WIRELESS
          example: WIRED
        id:
          type: string
          format: uuid
          description: Unique identifier for the client
          example: f95a0eb4-ddf9-3f41-942c-1793ac30d4c9
        name:
          type: string
          description: Display name or hostname of the client
          example: truenas 05:8d
        connectedAt:
          type: string
          format: date-time
          description: Timestamp when client connected (RFC3339 format)
          example: "2025-10-19T10:09:31Z"
        ipAddress:
          type: string
          description: IP address assigned to the client
          example: 172.16.10.19
        macAddress:
          type: string
          description: MAC address of the client
          example: "80:af:ca:ad:05:8d"
        uplinkDeviceId:
          type: string
          format: uuid
          description: ID of the device this client is connected to
          example: 71cb254a-b068-39f9-9138-0fbf8fe11cac
        access:
          $ref: '#/components/schemas/ClientAccess'

    NetworkClient:
      allOf:
        - $ref: '#/components/schemas/ClientListItem'

    ClientAccess:
      type: object
      required:
        - type
      properties:
        type:
          type: string
          description: Access control type
          enum:
            - DEFAULT
            - RESTRICTED
            - BLOCKED
          example: DEFAULT

    # DNS Records
    DNSRecord:
      type: object
      required:
        - _id
        - enabled
        - key
        - record_type
        - value
      properties:
        _id:
          type: string
          description: Unique identifier for the DNS record
          example: 68e04e991056cd46ea9edcd4
        enabled:
          type: boolean
          description: Whether the DNS record is enabled
          example: true
        key:
          type: string
          description: DNS record name (hostname or domain)
          example: "*.home.lex.la"
        record_type:
          type: string
          description: DNS record type
          enum:
            - A
            - AAAA
            - CNAME
            - MX
            - NS
            - SRV
            - TXT
          example: A
        value:
          type: string
          description: DNS record value (IP address, target hostname, etc.)
          example: 172.16.100.250
        ttl:
          type: integer
          description: Time to live in seconds (0 = default)
          default: 0
          example: 0
        priority:
          type: integer
          description: Priority for MX and SRV records
          example: 0
        weight:
          type: integer
          description: Weight for SRV records
          example: 0
        port:
          type: integer
          description: Port number for SRV records
          example: 0

    DNSRecordInput:
      type: object
      required:
        - key
        - record_type
        - value
      properties:
        enabled:
          type: boolean
          description: Whether the DNS record should be enabled
          default: true
          example: true
        key:
          type: string
          description: DNS record name (hostname or domain)
          example: "api.example.com"
        record_type:
          type: string
          description: DNS record type
          enum:
            - A
            - AAAA
            - CNAME
            - MX
            - NS
            - SRV
            - TXT
          example: A
        value:
          type: string
          description: DNS record value (IP address, target hostname, etc.)
          example: 192.168.1.100
        ttl:
          type: integer
          description: Time to live in seconds (0 = default)
          default: 0
          example: 0
        priority:
          type: integer
          description: Priority for MX and SRV records
          example: 10
        weight:
          type: integer
          description: Weight for SRV records
          example: 5
        port:
          type: integer
          description: Port number for SRV records
          example: 443
